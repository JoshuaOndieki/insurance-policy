<app-header class="sticky top-0 z-50"/>

@if (insurancePoliciesResource.status() === ResourceStatus.Loading || insurancePoliciesResource.status() === ResourceStatus.Reloading) {
  <div class="flex-1 flex items-center justify-center">
    <svg xmlns="http://www.w3.org/2000/svg" class="spinner-4 w-10 h-10 shrink-0 animate-spin" viewBox="0 0 512 512">
      <path fill="#26e4ff" d="M256 65.831c-8.826 0-15.981-7.155-15.981-15.981V15.981C240.019 7.155 247.174 0 256 0s15.981 7.155 15.981 15.981V49.85c0 8.826-7.155 15.981-15.981 15.981z" data-original="#26e4ff" />
      <path fill="#5c32cf" d="M256 512c-8.826 0-15.981-7.155-15.981-15.981V462.15c0-8.826 7.155-15.981 15.981-15.981s15.981 7.155 15.981 15.981v33.869c0 8.826-7.155 15.981-15.981 15.981z" data-original="#5c32cf" />
      <path fill="#50f3ff" d="M160.916 91.309c-7.644 4.413-17.417 1.794-21.831-5.849l-16.934-29.331c-4.413-7.644-1.794-17.417 5.849-21.83 7.644-4.413 17.417-1.794 21.83 5.849l16.934 29.331c4.414 7.643 1.795 17.417-5.848 21.83z" data-original="#50f3ff" />
      <path fill="#0b6fff" d="M384 477.702c-7.644 4.413-17.417 1.794-21.831-5.849l-16.934-29.331c-4.413-7.644-1.794-17.417 5.849-21.831 7.644-4.413 17.417-1.794 21.831 5.849l16.934 29.331c4.414 7.645 1.795 17.418-5.849 21.831z" data-original="#0b6fff" />
      <path fill="#88fcff" d="M91.309 160.915c-4.413 7.644-14.187 10.263-21.831 5.849L40.147 149.83c-7.644-4.413-10.262-14.187-5.849-21.83 4.413-7.644 14.187-10.262 21.83-5.849l29.331 16.934c7.644 4.413 10.263 14.187 5.85 21.83z" data-original="#88fcff" />
      <path fill="#089bff" d="M477.702 384c-4.413 7.644-14.187 10.263-21.831 5.849l-29.331-16.934c-7.644-4.413-10.262-14.187-5.849-21.83 4.413-7.644 14.187-10.263 21.83-5.849l29.331 16.934c7.645 4.413 10.264 14.186 5.85 21.83z" data-original="#089bff" />
      <path fill="#bff" d="M65.831 256c0 8.826-7.155 15.981-15.981 15.981H15.981C7.155 271.981 0 264.826 0 256s7.155-15.981 15.981-15.981H49.85c8.826 0 15.981 7.155 15.981 15.981z" data-original="#bbffff" />
      <path fill="#06b9ff" d="M512 256c0 8.826-7.155 15.981-15.981 15.981H462.15c-8.826 0-15.981-7.155-15.981-15.981s7.155-15.981 15.981-15.981h33.869c8.826 0 15.981 7.155 15.981 15.981z" data-original="#06b9ff" />
      <path fill="#ab8eff" d="M91.309 351.084c4.413 7.644 1.794 17.417-5.849 21.831l-29.331 16.934c-7.644 4.413-17.417 1.794-21.83-5.849-4.413-7.644-1.794-17.417 5.849-21.83l29.331-16.934c7.643-4.414 17.417-1.795 21.83 5.848z" data-original="#ab8eff" />
      <path fill="#22d0ff" d="M477.703 128c4.413 7.644 1.794 17.417-5.849 21.831l-29.331 16.934c-7.644 4.413-17.417 1.794-21.83-5.849-4.413-7.644-1.794-17.417 5.849-21.83l29.331-16.934c7.643-4.414 17.416-1.796 21.83 5.848z" data-original="#22d0ff" />
      <path fill="#7a48ff" d="M160.915 420.691c7.644 4.413 10.263 14.187 5.849 21.831l-16.934 29.331c-4.413 7.644-14.187 10.262-21.83 5.849-7.644-4.413-10.262-14.187-5.849-21.83l16.934-29.331c4.413-7.644 14.187-10.263 21.83-5.85z" data-original="#7a48ff" />
      <path fill="#22d0ff" d="M384 34.298c7.644 4.413 10.263 14.187 5.849 21.831L372.915 85.46c-4.413 7.644-14.187 10.262-21.83 5.849-7.644-4.413-10.263-14.187-5.849-21.83l16.934-29.331c4.413-7.645 14.186-10.264 21.83-5.85z" data-original="#22d0ff" />
      <path fill="#26e4ff" d="M336.406 256c0 44.411-35.995 80.406-80.406 80.406-15.164 0-29.35-4.193-41.454-11.497-23.344-14.062-38.951-39.662-38.951-68.909 0-44.411 35.995-80.406 80.406-80.406 22.561 0 42.948 9.282 57.546 24.251 14.143 14.484 22.859 34.295 22.859 56.155z" data-original="#26e4ff" />
      <path fill="#22d0ff" d="M336.406 256c0 44.411-35.995 80.406-80.406 80.406-15.164 0-29.35-4.193-41.454-11.497 92.407-22.777 102.956-84.557 99-125.064 14.144 14.484 22.86 34.295 22.86 56.155z" data-original="#22d0ff" />
      <path fill="#e8e6ed" d="M336.406 256H256v-80.406c22.561 0 42.948 9.282 57.546 24.251v.01c14.155 14.485 22.86 34.295 22.86 56.145z" data-original="#e8e6ed" />
      <path fill="#d1d0d8" d="M306.551 256c7.809-19.532 8.612-39.61 6.995-56.145 14.155 14.484 22.86 34.295 22.86 56.145z" data-original="#d1d0d8" />
    </svg>
  </div>
} @else if(insurancePoliciesResource.status() === ResourceStatus.Error) {
  <app-error class="flex-1 flex items-center justify-center" title="Error Loading" details="Unable to load insurance policies."/>
} @else if (insurancePoliciesResource.status() === ResourceStatus.Resolved) {
  @if (insurancePoliciesResource.value()?.length) {
    <div class="w-full flex justify-end p-4 mt-2">
      <button type="button" (click)="this.showInsurancePolicyForm.set(true)"
              class="text-white h-10 px-4 inline-flex items-center justify-center border-none outline-none bg-blue-600 hover:bg-blue-700 active:bg-blue-600">
        <svg xmlns="http://www.w3.org/2000/svg" width="14px" fill="#fff" class="inline me-1" viewBox="0 0 512 512">
          <path
            d="M467 211H301V45c0-24.853-20.147-45-45-45s-45 20.147-45 45v166H45c-24.853 0-45 20.147-45 45s20.147 45 45 45h166v166c0 24.853 20.147 45 45 45s45-20.147 45-45V301h166c24.853 0 45-20.147 45-45s-20.147-45-45-45z"
            data-original="#000000"/>
        </svg>
        Add New Insurance Policy
      </button>
    </div>
    <div class="mx-4">
      <div class="overflow-x-auto ">
        <table class="min-w-full bg-white">
          <thead class="whitespace-nowrap bg-gray-100 rounded">
          <tr>
            <th #policyNumberTH class="p-4 text-sm sticky left-0 z-10 bg-gray-100 font-semibold text-black">
              Policy Number
            </th>
            <th [ngStyle]="{'left': leftOffset + 'px'}" class="p-4 text-left md:sticky md:z-10 bg-gray-100 text-sm font-semibold text-black">
              Policy Holder
            </th>
            <th class="p-4 text-left text-sm font-semibold text-black">
              Premium Value
            </th>
            <th class="p-4 text-left text-sm font-semibold text-black">
              Policy Start
            </th>
            <th class="p-4 text-left text-sm font-semibold text-black">
              Policy End
            </th>
            <th class="p-4 text-sm font-semibold text-black">
              Status
              <span class="relative group">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-[12px] fill-gray-300 inline mr-3" viewBox="0 0 23.625 23.625">
                  <path
                    d="M11.812 0C5.289 0 0 5.289 0 11.812s5.289 11.813 11.812 11.813 11.813-5.29 11.813-11.813S18.335 0 11.812 0zm2.459 18.307c-.608.24-1.092.422-1.455.548a3.838 3.838 0 0 1-1.262.189c-.736 0-1.309-.18-1.717-.539s-.611-.814-.611-1.367c0-.215.015-.435.045-.659a8.23 8.23 0 0 1 .147-.759l.761-2.688c.067-.258.125-.503.171-.731.046-.23.068-.441.068-.633 0-.342-.071-.582-.212-.717-.143-.135-.412-.201-.813-.201-.196 0-.398.029-.605.09-.205.063-.383.12-.529.176l.201-.828c.498-.203.975-.377 1.43-.521a4.225 4.225 0 0 1 1.29-.218c.731 0 1.295.178 1.692.53.395.353.594.812.594 1.376 0 .117-.014.323-.041.617a4.129 4.129 0 0 1-.152.811l-.757 2.68a7.582 7.582 0 0 0-.167.736 3.892 3.892 0 0 0-.073.626c0 .356.079.599.239.728.158.129.435.194.827.194.185 0 .392-.033.626-.097.232-.064.4-.121.506-.17l-.203.827zm-.134-10.878a1.807 1.807 0 0 1-1.275.492c-.496 0-.924-.164-1.28-.492a1.57 1.57 0 0 1-.533-1.193c0-.465.18-.865.533-1.196a1.812 1.812 0 0 1 1.28-.497c.497 0 .923.165 1.275.497.353.331.53.731.53 1.196 0 .467-.177.865-.53 1.193z"
                    data-original="#030104" />
                </svg>
                <div
                  class="max-w-xs absolute shadow-lg hidden group-hover:block bg-gray-500 text-white font-semibold px-3 py-[6px] text-xs right-0 left-0 mx-auto w-max -bottom-10 rounded">
                  Status based on insurance policy dates.</div>
              </span>
            </th>
            <th class="p-4 w-64 text-left text-sm font-semibold text-black">
              Coverage Details
            </th>
            <th class="py-4 px-2 text-left text-xs font-semibold text-black">
              Added Date
            </th>
            <th class="py-4 px-2 text-left text-xs font-semibold text-black">
              Modified Date
            </th>
            <th class="px-4 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
              Actions
            </th>
          </tr>
          </thead>

          <tbody class="whitespace-nowrap">
            @for (insurancePolicy of insurancePoliciesResource.value(); track insurancePolicy.id) {
              <tr class="hover:bg-gray-50 group">
                <th class="sticky left-0 bg-white group-hover:bg-gray-50 w-auto">{{insurancePolicy.policyNumber}}</th>
                <td [ngStyle]="{'left': leftOffset + 'px'}" class="p-4 text-sm md:sticky bg-white group-hover:bg-gray-50 text-black">
                  <div class="flex items-center cursor-pointer w-max">
                    <img src='/Profile_avatar_placeholder_large.png' class="w-9 h-9 rounded-md shrink-0"/>
                    <div class="ml-4">
                      <p class="text-sm text-black">{{insurancePolicy.holderName}}</p>
                      <p *ngIf="insurancePolicy.holderEmail" class="text-xs text-gray-500">{{insurancePolicy.holderEmail}}</p>
                      <p *ngIf="insurancePolicy.holderPhone" class="text-xs text-gray-500">{{insurancePolicy.holderPhone}}</p>
                    </div>
                  </div>
                </td>
                <td class="p-4 text-sm text-black">
                  {{insurancePolicy.premiumAmount | currency: 'KES '}}
<!--                  <p class="text-xs text-gray-500 mt-1">In Process</p>-->
                </td>
                <td class="p-4 text-sm text-black">
                  {{insurancePolicy.startDate | date: 'medium'}}
<!--                  <p class="text-xs text-gray-500 mt-1">Paid</p>-->
                </td>
                <td class="p-4 text-sm text-black">
                  {{insurancePolicy.endDate | date: 'medium'}}
<!--                  <p class="text-xs text-gray-500 mt-1">Web UI/UX Design</p>-->
                </td>
                <td class="p-4">
                  @if (insurancePolicyStatus(insurancePolicy) === 'active') {
                    <span type="button" class="flex items-center text-green-600 text-xs bg-green-50 px-3 py-1 tracking-wide rounded-full">
                      Active
                    </span>
                  } @else if(insurancePolicyStatus(insurancePolicy) === 'pending') {
                    <span type="button" class="flex items-center text-blue-600 text-xs bg-blue-50 px-3 py-1 tracking-wide rounded-full">
                      Pending
                    </span>
                  } @else {
                    <span class="flex items-center text-red-600 text-xs bg-red-50 px-3 py-1 tracking-wide rounded-full">
                      Closed
                    </span>
                  }
<!--                  <div class="bg-gray-300 rounded-full w-full h-2">-->
<!--                    <div class="w-2/3 h-full rounded-full bg-green-500"></div>-->
<!--                  </div>-->
<!--                  <p class="text-xs text-gray-500 mt-1">Total : 800</p>-->
                </td>
                <td class="p-4">
                  <p class="w-64 text-wrap text-sm">{{insurancePolicy.coverageDetails}}</p>
                </td>
                <td class="p-4 text-xs text-gray-500">
                  {{insurancePolicy.createdAtUtc ? dateFormatter(insurancePolicy.createdAtUtc) : '-'}}
                </td>
                <td class="p-4 text-xs text-gray-500">
                  {{insurancePolicy.lastModifiedAtUtc ? dateFormatter(insurancePolicy.lastModifiedAtUtc) : '-'}}
                </td>
                <td class="px-4 py-4 text-sm text-gray-800">
                  <button class="text-blue-600 mr-4" (click)="insurancePolicyOnForm.set(insurancePolicy); showInsurancePolicyForm.set(true)">Edit</button>
                  <button class="text-red-600" (click)="showConfirmDeleteDialog.set(true); insurancePolicyToDelete.set(insurancePolicy)">Delete</button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <div class="md:flex m-4">
        <p class="text-sm text-gray-500 flex-1">Showing 1 to 5 of 100 entries</p>
        <div class="flex items-center max-md:mt-4">
          <p class="text-sm text-gray-500">Display</p>

          <select class="text-sm text-gray-500 border border-gray-400 rounded px-1 py-2 mx-4 outline-none">
            <option>5</option>
            <option>10</option>
            <option>20</option>
            <option>50</option>
            <option>100</option>
          </select>

          <div class="border flex rounded divide-x-2 border-gray-400 divide-gray-400">
            <button type="button" class="px-4 py-2 hover:bg-gray-50 text-sm">Previous</button>
            <button type="button" class="px-4 py-2 hover:bg-gray-50 text-sm">Next</button>
          </div>
        </div>
      </div>
    </div>
  } @else {
    <div class="p-32 bg-slate-50">
      <div class="container flex flex-wrap justify-between items-center mx-auto bg-white rounded-md">
        <div class="text-center border-dashed border-2 border-slate-200 rounded-md w-full p-20">
          <i class='bx bxs-contact bx-lg mb-5'></i>
          <p class="text-xl mb-2 uppercase font-bold">No Insurance Policies</p>
          <p class="text-m text-slate-400 block mb-10">Get started by adding a new insurance policy</p>
          <button type="button" (click)="this.showInsurancePolicyForm.set(true)"
                  class="text-white h-10 px-4 inline-flex items-center justify-center border-none outline-none bg-blue-600 hover:bg-blue-700 active:bg-blue-600">
            <svg xmlns="http://www.w3.org/2000/svg" width="14px" fill="#fff" class="inline me-1" viewBox="0 0 512 512">
              <path
                d="M467 211H301V45c0-24.853-20.147-45-45-45s-45 20.147-45 45v166H45c-24.853 0-45 20.147-45 45s20.147 45 45 45h166v166c0 24.853 20.147 45 45 45s45-20.147 45-45V301h166c24.853 0 45-20.147 45-45s-20.147-45-45-45z"
                data-original="#000000"/>
            </svg>
            Add New Insurance Policy
          </button>
        </div>
      </div>
    </div>
  }
}

@if (showInsurancePolicyForm()) {
  <app-insurance-policy-form (onClose)="showInsurancePolicyForm.set(false)"
                             (afterAnyEvent)="showInsurancePolicyForm.set(false); afterAnyFormEvent($event)"
                             [insurancePolicy]="insurancePolicyOnForm()"/>
}

@if (showConfirmDeleteDialog()) {
  <app-confirm-delete-dialog
    [info]="'Policy ' + insurancePolicyToDelete()?.policyNumber "
    (onCancel)="showConfirmDeleteDialog.set(false); insurancePolicyToDelete.set(null)"
    (onConfirm)="showConfirmDeleteDialog.set(false); deleteInsurancePolicy(insurancePolicyToDelete()?.id ?? ''); insurancePolicyToDelete.set(null)"/>
}
